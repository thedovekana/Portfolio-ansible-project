- name: Update package cache (for yum)
      yum:
        name: '*'
        state: latest
      when: ansible_os_family == "RedHat"  # Use this condition if your target is a RedHat-based system

    - name: Install system-level dependencies (RedHat)
      package:
        name: "{{ item }}"
        state: present
      with_items:
        - python3
        - python3-pip
        - pip
      when: ansible_os_family == "RedHat"  # Adjust this condition for your target OS

    - name: Clone the repo from github
      git:
        repo: https://github.com/Joshuaoji/portfolio-website.git
        dest: /home/tomcat/portfolio-website

    - name: Install Python dependencies using pip
      command: cd portfolio-website && pip3 install -r requirements.txt

    - name: Configure the application as a service  by creating a systemd file
      template:
        src: templates/app.service.j2
        dest: /etc/systemd/system/app.service
      notify: Restart systemd

    - name: Start the service & enable it
      systemd:
        name: app
        state: started
        enabled: yes
      notify: Restart systemd

  handlers:
    - name: Restart systemd
      systemd:
        name: app
        state: restarted


